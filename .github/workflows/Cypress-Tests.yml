name: Cypress tests
# the event(s) that trigger the workflow
on:
  push:
    branches:
      - develop
  pull_request:
    branches:
      - develop
jobs:
  cypress-run:
    name: Cypress run
    # jobs run in their own environments specified by "runs-on"
    # in this case we are using the latest version of ubuntu
    runs-on: ubuntu-latest
    # stops the job if it runs over 10 minutes
    # to prevent hanging process from using all of CI minutes
    # you can also individual step timeout too
    timeout-minutes: 10
    
    steps:
      # Install NPM dependencies, cache them correctly
      # and run all Cypress tests
      - name: Checkout
        uses: actions/checkout@v2    
      - name: Cypress run
        uses: cypress-io/github-action@v2
        with:
        # starts the localhost 
          start: npx @11ty/eleventy --serve
      # You can pass multiple specs using multi-line parameter
          spec: |
            cypress/integration/examples/axe.spec.js
      
      # after the test run completes
      # store videos and any screenshots
      # NOTE: screenshots will be generated only if E2E test failed, thus we store screenshots only on failures
      - uses: actions/upload-artifact@v2
        if: failure()
        with:
          name: cypress-screenshots
          path: cypress/screenshots
      # Test run video was always captured, so this action uses "always()" condition          
      - uses: actions/upload-artifact@v2
        if: always()
        with:
          name: cypress-videos
          path: cypress/videos        
